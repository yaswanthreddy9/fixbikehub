<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>BikeFix Hub</title>

<style>
*{margin:0;padding:0;box-sizing:border-box;font-family:Arial,Helvetica,sans-serif}
body{background:#f4f4f4;color:#222}
header{background:#111827;color:#fff;padding:12px;position:sticky;top:0;z-index:10}
.nav{max-width:1100px;margin:auto;display:flex;align-items:center;justify-content:space-between;gap:10px}
.logo{font-size:20px;font-weight:700;cursor:pointer}
.toolbar{display:flex;align-items:center;gap:8px}
.search-box input{padding:8px 10px;border-radius:50px;border:1px solid #555;background:#000;color:#fff;width:220px}
.header-btn{background:#111;border:1px solid #666;color:white;padding:6px 10px;border-radius:50px;cursor:pointer}

.lang-strip{max-width:200px;overflow-x:auto}
.lang-pill{padding:4px 10px;border-radius:999px;border:1px solid #666;background:#111;color:#fff;font-size:11px;cursor:pointer}
.lang-pill.active{border-color:#facc15;box-shadow:0 0 6px #facc15}

main{max-width:1100px;margin:auto;padding:16px}
.filters-title{margin:12px 0;font-weight:600}
.buttons{display:flex;flex-wrap:wrap;gap:8px}
.filter-btn{padding:8px 15px;border-radius:50px;border:1px solid #aaa;background:white;cursor:pointer}
.filter-btn.active{background:#2563eb;color:white;border-color:#0d56db}

.video-grid{display:grid;gap:15px;margin-top:20px}
.video-card{background:white;border-radius:10px;overflow:hidden;box-shadow:0 4px 10px rgba(0,0,0,.1)}
iframe{width:100%;height:220px;border:none}
.video-info{padding:10px;font-size:14px;font-weight:600}
#empty{background:#ddd;padding:20px;border-radius:10px;margin-top:20px;text-align:center}
</style>
</head>

<body>
<header>
  <div class="nav">
    <div class="logo" id="logo">BikeFix Hub</div>
    <div class="toolbar">
      <div class="search-box">
        <input id="searchInput" placeholder="Search videos..">
      </div>
      <div class="lang-strip">
        <button class="lang-pill" data-lang="en">English</button>
        <button class="lang-pill" data-lang="hi">‡§π‡§ø‡§®‡•ç‡§¶‡•Ä</button>
        <button class="lang-pill" data-lang="te">‡∞§‡±Ü‡∞≤‡±Å‡∞ó‡±Å</button>
        <button class="lang-pill" data-lang="ta">‡Æ§‡ÆÆ‡Æø‡Æ¥‡Øç</button>
      </div>
      <button id="userBtn" class="header-btn">üë§</button>
    </div>
  </div>
</header>

<main>
  <div class="filters-title">1. Choose Brand</div>
  <div id="brandButtons" class="buttons">
    <button class="filter-btn" data-brand="hero">Hero MotoCorp</button>
    <button class="filter-btn" data-brand="bajaj">Bajaj Auto</button>
    <button class="filter-btn" data-brand="tvs">TVS Motor</button>
    <button class="filter-btn" data-brand="royal">Royal Enfield</button>
  </div>

  <div class="filters-title">2. Choose Model</div>
  <div id="modelButtons" class="buttons"></div>

  <div id="empty">No videos yet. Add videos using admin mode.</div>
  <div id="videos" class="video-grid"></div>
</main>

<!-- Firebase -->
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>

<script>
/* ---------------- FIREBASE ---------------- */
firebase.initializeApp({
  apiKey: "AIzaSyBU93PMVY7YKUaez3tkpiywYtIcpZTUQBw",
  authDomain: "bike-fix-pulsar.firebaseapp.com",
  projectId: "bike-fix-pulsar",
  storageBucket: "bike-fix-pulsar.firebasestorage.app",
  messagingSenderId: "464082773378",
  appId: "1:464082773378:web:6376c2ddd5635fd2061b9b"
});
const db = firebase.firestore();
const auth = firebase.auth();

/* ---------------- DATA ---------------- */
const models = {
  hero:["Splendor Plus","HF Deluxe","Glamour"],
  bajaj:["All Pulsar (General)","Pulsar 150","Pulsar NS200"],
  tvs:["Apache RTR 160","Raider 125"],
  royal:["Classic 350","Himalayan 450"]
};

let activeBrand = "hero";
let activeModel = null;
let videos = [];
let currentUser = null;

/* ---------------- STATE INIT (FIX) ---------------- */
function initBrandState(){
  const stored = localStorage.getItem("lastBrand");
  if(stored && models[stored]) activeBrand = stored;
}

function applyBrandUI(){
  document.querySelectorAll("#brandButtons .filter-btn").forEach(btn=>{
    btn.classList.toggle("active", btn.dataset.brand === activeBrand);
  });
}

/* ---------------- MODELS ---------------- */
function loadModels(preferred){
  const box = document.getElementById("modelButtons");
  box.innerHTML="";
  const list = models[activeBrand] || [];
  activeModel = preferred && list.includes(preferred) ? preferred : list[0];

  list.forEach(m=>{
    const b=document.createElement("button");
    b.className="filter-btn"+(m===activeModel?" active":"");
    b.textContent=m;
    b.onclick=()=>{
      document.querySelectorAll("#modelButtons .filter-btn").forEach(x=>x.classList.remove("active"));
      b.classList.add("active");
      activeModel=m;
      savePrefs();
      render();
    };
    box.appendChild(b);
  });
}

/* ---------------- SAVE PREFS ---------------- */
function savePrefs(){
  localStorage.setItem("lastBrand",activeBrand);
  localStorage.setItem("lastModel",activeModel||"");
  if(currentUser){
    db.collection("userPrefs").doc(currentUser.uid)
      .set({lastBrand:activeBrand,lastModel:activeModel},{merge:true});
  }
}

/* ---------------- LOAD USER PREFS ---------------- */
function loadUserPrefs(uid){
  db.collection("userPrefs").doc(uid).get().then(doc=>{
    if(doc.exists){
      const d=doc.data();
      if(d.lastBrand && models[d.lastBrand]){
        activeBrand=d.lastBrand;
        applyBrandUI();
        loadModels(d.lastModel);
        render();
      }
    }
  });
}

/* ---------------- RENDER ---------------- */
function render(){
  const grid=document.getElementById("videos");
  grid.innerHTML="";
  const q=document.getElementById("searchInput").value.toLowerCase();
  videos.forEach(v=>{
    if(v.brand!==activeBrand||v.model!==activeModel) return;
    if(!v.title.toLowerCase().includes(q)) return;
    const c=document.createElement("div");
    c.className="video-card";
    c.innerHTML=`
      <iframe src="https://www.youtube.com/embed/${v.ytId}" allowfullscreen></iframe>
      <div class="video-info">${v.title}</div>`;
    grid.appendChild(c);
  });
  document.getElementById("empty").style.display = grid.children.length?"none":"block";
}

/* ---------------- BRAND CLICK ---------------- */
document.querySelectorAll("#brandButtons .filter-btn").forEach(btn=>{
  btn.onclick=()=>{
    activeBrand=btn.dataset.brand;
    localStorage.removeItem("lastModel");
    applyBrandUI();
    loadModels(null);
    savePrefs();
    render();
  };
});

/* ---------------- AUTH ---------------- */
auth.onAuthStateChanged(user=>{
  currentUser=user;
  if(user) loadUserPrefs(user.uid);
});

/* ---------------- FIRESTORE ---------------- */
db.collection("videos").onSnapshot(snap=>{
  videos=[];
  snap.forEach(d=>videos.push({id:d.id,...d.data()}));
  render();
});

/* ---------------- INIT ---------------- */
initBrandState();
applyBrandUI();
loadModels(localStorage.getItem("lastModel"));
render();
</script>
</body>
</html>
