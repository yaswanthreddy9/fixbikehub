<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>BikeFix Hub</title>

  <style>
    /* ---- BASE STYLES ---- */
    *{margin:0;padding:0;box-sizing:border-box;font-family:Arial,Helvetica,sans-serif}
    body{background:#f4f4f4;color:#222}
    header{background:#111827;color:#fff;padding:12px;position:sticky;top:0;z-index:10}
    .nav{display:flex;align-items:center;justify-content:space-between;gap:10px;max-width:1100px;margin:auto;flex-wrap:wrap}
    .logo{font-size:20px;font-weight:700;cursor:pointer}
    .toolbar{display:flex;align-items:center;gap:8px;flex-wrap:nowrap}
    .search-box input{padding:8px 10px;border-radius:50px;border:1px solid #555;background:#000;color:#fff;width:220px;font-size:14px}
    .header-btn{background:#111;border:1px solid #666;color:white;padding:6px 10px;border-radius:50px;cursor:pointer;font-size:16px;min-width:40px;text-align:center}

    .lang-strip{max-width:190px;overflow-x:auto}
    #langScroll{display:flex;gap:4px}
    .lang-pill{padding:4px 10px;border-radius:999px;border:1px solid #666;background:#111;color:#fff;font-size:11px;white-space:nowrap;cursor:pointer;opacity:.8}
    .lang-pill.active{border-color:#facc15;opacity:1;animation:langBlink 1.5s infinite}
    @keyframes langBlink{0%,100%{box-shadow:0 0 0px #facc15}50%{box-shadow:0 0 8px #facc15}}

    main{max-width:1100px;margin:auto;padding:16px}
    .filters-title{font-size:14px;margin:10px 0;color:#444;font-weight:600}
    .buttons{display:flex;flex-wrap:wrap;gap:8px}
    .filter-btn{padding:8px 15px;border-radius:50px;border:1px solid #aaa;background:white;cursor:pointer;font-size:14px}
    .filter-btn.active{background:#2563eb;color:white;border-color:#0d56db}

    .top-meta{display:flex;flex-wrap:wrap;justify-content:space-between;align-items:center;gap:8px;margin-top:10px}
    .view-tabs{display:flex;gap:6px}
    .view-tab{padding:6px 10px;border-radius:999px;border:1px solid #999;background:#f3f4f6;font-size:12px;cursor:pointer}
    .view-tab.active{background:#111827;color:#fff;border-color:#111827}
    .last-updated{font-size:11px;color:#666}

    .video-grid{display:grid;gap:15px;margin-top:20px}
    .video-card{background:white;border-radius:10px;box-shadow:0 4px 10px rgba(0,0,0,.1);overflow:hidden;cursor:pointer}
    .thumb-wrapper{position:relative;width:100%;padding-top:56.25%;background:#000;overflow:hidden}
    .thumb-wrapper img{position:absolute;top:0;left:0;width:100%;height:100%;object-fit:cover}
    .thumb-overlay{position:absolute;inset:0;display:flex;align-items:center;justify-content:center;background:linear-gradient(to top,rgba(0,0,0,.6),rgba(0,0,0,.1))}
    .play-btn{width:54px;height:54px;border-radius:50%;background:rgba(0,0,0,.7);border:2px solid #fff;display:flex;align-items:center;justify-content:center}
    .play-btn::before{content:"";border-left:14px solid #fff;border-top:8px solid transparent;border-bottom:8px solid transparent;margin-left:3px}
    .video-info{padding:10px;font-size:14px;font-weight:600}
    .video-meta{margin-top:6px;font-size:12px;display:flex;justify-content:space-between;align-items:center;gap:6px;color:#555}
    .admin-actions button{border:none;padding:4px 6px;border-radius:5px;font-size:11px;cursor:pointer}
    .edit-btn{background:#f59e0b;color:white}
    .delete-btn{background:#ef4444;color:white}
    #empty{background:#ddd;text-align:center;padding:20px;border-radius:10px;margin-top:20px;color:#444}

    /* ---- ADMIN PANEL ---- */
    #adminPanel{display:none;background:#e5e7eb;padding:15px;border-radius:10px;margin-top:20px}
    #adminPanel label{font-size:13px;font-weight:600;margin-top:8px;display:block}
    #adminPanel input,#adminPanel select{padding:6px;border-radius:6px;border:1px solid #ccc;width:100%;margin-top:4px;font-size:14px}
    #adminPanel button{padding:8px 10px;background:#22c55e;color:white;border:none;border-radius:6px;font-weight:bold;cursor:pointer;margin-top:10px;font-size:13px}
    #adminNote{font-size:12px;margin-bottom:6px;color:#555}
    #backupRow{display:flex;flex-wrap:wrap;gap:8px;margin-top:8px}
    #backupRow button,#backupRow label{background:#0ea5e9;color:white;border:none;border-radius:6px;padding:6px 10px;font-size:12px;font-weight:bold;cursor:pointer}
    #backupRow input{display:none}
    #logoutBtn{background:#ef4444;margin-left:auto}

    /* ---- DARK MODE ---- */
    body.dark{background:#0f0f0f;color:white}
    body.dark header{background:#000}
    body.dark .filter-btn{background:#1a1a1a;border-color:#333;color:white}
    body.dark .filter-btn.active{background:#2563eb;color:white}
    body.dark input,body.dark select{background:#111;color:white;border-color:#444}
    body.dark .video-card{background:#1a1a1a}
    body.dark #empty{background:#333;color:#bbb}
    body.dark .view-tab{background:#111;border-color:#444;color:#ddd}
    body.dark .view-tab.active{background:#2563eb;border-color:#2563eb}
    body.dark .last-updated{color:#aaa}
    body.dark .lang-pill{background:#000;border-color:#999}

    /* --- MOBILE LAYOUT --- */
    @media(max-width:600px){
      .nav{flex-direction:column;align-items:stretch}
      .toolbar{width:100%;justify-content:center;flex-wrap:wrap}
      .search-box{flex:1}
      .search-box input{width:100%}
    }
  </style>
</head>

<body>
  <header>
    <div class="nav">
      <div class="logo" id="logo">BikeFix Hub</div>
      <div class="toolbar">
        <div class="search-box">
          <input id="searchInput" placeholder="Search videos.." />
        </div>
        <button id="darkToggle" class="header-btn">üåô</button>
        <button id="refreshBtn" class="header-btn">‚ü≥</button>
        <div class="lang-strip">
          <div id="langScroll">
            <button class="lang-pill active" data-lang="en">English</button>
            <button class="lang-pill" data-lang="hi">‡§π‡§ø‡§®‡•ç‡§¶‡•Ä</button>
            <button class="lang-pill" data-lang="te">‡∞§‡±Ü‡∞≤‡±Å‡∞ó‡±Å</button>
            <button class="lang-pill" data-lang="ta">‡Æ§‡ÆÆ‡Æø‡Æ¥‡Øç</button>
          </div>
        </div>
      </div>
    </div>
  </header>

  <main>
    <div class="top-meta">
      <div class="view-tabs">
        <button class="view-tab active" data-view="bike" id="tabByBike">By Bike</button>
        <button class="view-tab" data-view="all" id="tabAllVideos">All Videos</button>
      </div>
      <div class="last-updated" id="lastUpdated"></div>
    </div>

    <div class="filters-title" data-i18n="chooseBrand">1. Choose Brand</div>
    <div id="brandButtons" class="buttons">
      <button class="filter-btn active" data-brand="hero">Hero MotoCorp</button>
      <button class="filter-btn" data-brand="bajaj">Bajaj Auto</button>
      <button class="filter-btn" data-brand="tvs">TVS Motor</button>
      <button class="filter-btn" data-brand="royal">Royal Enfield</button>
    </div>

    <div class="filters-title" data-i18n="chooseModel">2. Choose Model</div>
    <div id="modelButtons" class="buttons"></div>

    <div id="empty" data-i18n="noVideos">No videos yet. Add videos using admin mode.</div>
    <div id="videos" class="video-grid"></div>

    <div id="adminPanel">
      <div id="adminNote">
        <span data-i18n="adminStatusLabel">Admin status:</span>
        <b id="adminStatus">Not logged in</b>
      </div>

      <h3 data-i18n="addVideoTitle">Add Video</h3>

      <label data-i18n="brandLabel">Brand</label>
      <select id="adminBrand"></select>

      <label data-i18n="modelLabel">Model</label>
      <select id="adminModel"></select>

      <label data-i18n="videoTitleLabel">Video Title</label>
      <input id="adminTitle" placeholder="Ex: Pulsar 150 Clutch Repair" />

      <label data-i18n="youtubeLabel">YouTube URL or ID</label>
      <input id="adminUrl" placeholder="https://youtube.com/watch?v=xxxx" />

      <button id="addVideoBtn" data-i18n="addVideoButton">Add Video</button>

      <div id="backupRow">
        <button id="exportBtn" type="button" data-i18n="exportBackup">Export Backup</button>
        <label for="importInput" data-i18n="importBackup">Import Backup
          <input id="importInput" type="file" accept="application/json" />
        </label>
        <button id="logoutBtn" type="button" data-i18n="logout">Logout</button>
      </div>
    </div>
  </main>

  <!-- Firebase CDN -->
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>

  <script>
    document.addEventListener("DOMContentLoaded", function () {

      /* ------------ FIREBASE CONFIG ------------ */
      const firebaseConfig = {
        apiKey: "AIzaSyBU93PMVY7YKUaez3tkpiywYtIcpZTUQBw",
        authDomain: "bike-fix-pulsar.firebaseapp.com",
        projectId: "bike-fix-pulsar",
        storageBucket: "bike-fix-pulsar.firebasestorage.app",
        messagingSenderId: "464082773378",
        appId: "1:464082773378:web:6376c2ddd5635fd2061b9b"
      };

      firebase.initializeApp(firebaseConfig);
      const db = firebase.firestore();
      const auth = firebase.auth();
      const provider = new firebase.auth.GoogleAuthProvider();

      const ADMIN_EMAIL = "myeswanthreddy321@gmail.com";

      /* ------------ MODEL DATA ------------ */
      const models = {
        hero:["Splendor Plus","HF Deluxe","Glamour","Passion Plus","Xtreme 160R","Xpulse 200 4V","Karizma XMR","Mavrick 440"],
        bajaj:["All Pulsar (General)","Pulsar 150","Pulsar NS200","Pulsar 220F","Dominar 400","Avenger Cruise 220","Platina","Chetak Electric"],
        tvs:["Apache RTR 160","Apache RTR 310","Raider 125","Ronin","Sport","Jupiter","iQube Electric"],
        royal:["Classic 350","Bullet 350","Himalayan 450","Interceptor 650","Meteor 350","Hunter 350","Shotgun 650"]
      };

      let activeBrand = "hero";
      let activeModel = null;
      let adminUnlocked = false;
      let videos = []; // {id, brand, model, title, ytId, createdAtMs}
      let latestUpdated = null;
      let viewMode = "bike"; // "bike" or "all"

      const search = document.getElementById("searchInput");
      const videoGrid = document.getElementById("videos");
      const empty = document.getElementById("empty");
      const adminStatus = document.getElementById("adminStatus");
      const adminPanel = document.getElementById("adminPanel");
      const logo = document.getElementById("logo");
      const lastUpdatedEl = document.getElementById("lastUpdated");

      /* ------------ LANGUAGE SYSTEM ------------ */
      const translations = {
        en:{
          title:"BikeFix Hub",
          search:"Search videos..",
          chooseBrand:"1. Choose Brand",
          chooseModel:"2. Choose Model",
          noVideos:"No videos yet. Add videos using admin mode.",
          adminStatusLabel:"Admin status:",
          addVideoTitle:"Add Video",
          brandLabel:"Brand",
          modelLabel:"Model",
          videoTitleLabel:"Video Title",
          youtubeLabel:"YouTube URL or ID",
          addVideoButton:"Add Video",
          exportBackup:"Export Backup",
          importBackup:"Import Backup",
          logout:"Logout",
          lastUpdatedPrefix:"Last updated:",
          viewByBike:"By Bike",
          viewAll:"All Videos"
        },
        hi:{
          title:"BikeFix Hub",
          search:"‡§µ‡•Ä‡§°‡§ø‡§Ø‡•ã ‡§ñ‡•ã‡§ú‡•á‡§Ç..",
          chooseBrand:"1. ‡§¨‡•ç‡§∞‡§æ‡§Ç‡§° ‡§ö‡•Å‡§®‡•á‡§Ç",
          chooseModel:"2. ‡§Æ‡•â‡§°‡§≤ ‡§ö‡•Å‡§®‡•á‡§Ç",
          noVideos:"‡§ï‡•ã‡§à ‡§µ‡•Ä‡§°‡§ø‡§Ø‡•ã ‡§®‡§π‡•Ä‡§Ç‡•§ ‡§è‡§°‡§Æ‡§ø‡§® ‡§∏‡•á ‡§µ‡•Ä‡§°‡§ø‡§Ø‡•ã ‡§ú‡•ã‡§°‡§º‡•á‡§Ç‡•§",
          adminStatusLabel:"‡§è‡§°‡§Æ‡§ø‡§® ‡§∏‡•ç‡§•‡§ø‡§§‡§ø:",
          addVideoTitle:"‡§µ‡•Ä‡§°‡§ø‡§Ø‡•ã ‡§ú‡•ã‡§°‡§º‡•á‡§Ç",
          brandLabel:"‡§¨‡•ç‡§∞‡§æ‡§Ç‡§°",
          modelLabel:"‡§Æ‡•â‡§°‡§≤",
          videoTitleLabel:"‡§µ‡•Ä‡§°‡§ø‡§Ø‡•ã ‡§ï‡§æ ‡§®‡§æ‡§Æ",
          youtubeLabel:"YouTube URL ‡§Ø‡§æ ID",
          addVideoButton:"‡§µ‡•Ä‡§°‡§ø‡§Ø‡•ã ‡§ú‡•ã‡§°‡§º‡•á‡§Ç",
          exportBackup:"‡§¨‡•à‡§ï‡§Ö‡§™ ‡§è‡§ï‡•ç‡§∏‡§™‡•ã‡§∞‡•ç‡§ü",
          importBackup:"‡§¨‡•à‡§ï‡§Ö‡§™ ‡§á‡§Æ‡•ç‡§™‡•ã‡§∞‡•ç‡§ü",
          logout:"‡§≤‡•â‡§ó‡§Ü‡§â‡§ü",
          lastUpdatedPrefix:"‡§Ü‡§ñ‡§ø‡§∞‡•Ä ‡§Ö‡§™‡§°‡•á‡§ü:",
          viewByBike:"‡§¨‡§æ‡§á‡§ï ‡§ï‡•á ‡§Ö‡§®‡•Å‡§∏‡§æ‡§∞",
          viewAll:"‡§∏‡§≠‡•Ä ‡§µ‡•Ä‡§°‡§ø‡§Ø‡•ã"
        },
        te:{
          title:"BikeFix Hub",
          search:"‡∞µ‡±Ä‡∞°‡∞ø‡∞Ø‡±ã‡∞≤‡±Å ‡∞∏‡±Ü‡∞∞‡±ç‡∞ö‡±ç ‡∞ö‡±á‡∞Ø‡∞Ç‡∞°‡∞ø..",
          chooseBrand:"1. ‡∞¨‡±ç‡∞∞‡∞æ‡∞Ç‡∞°‡±ç ‡∞é‡∞Ç‡∞ö‡±Å‡∞ï‡±ã‡∞Ç‡∞°‡∞ø",
          chooseModel:"2. ‡∞Æ‡±ã‡∞°‡∞≤‡±ç ‡∞é‡∞Ç‡∞ö‡±Å‡∞ï‡±ã‡∞Ç‡∞°‡∞ø",
          noVideos:"‡∞á‡∞™‡±ç‡∞™‡∞ü‡∞ø‡∞ï‡∞ø ‡∞µ‡±Ä‡∞°‡∞ø‡∞Ø‡±ã‡∞≤‡±Å ‡∞≤‡±á‡∞µ‡±Å. ‡∞Ö‡∞°‡±ç‡∞Æ‡∞ø‡∞®‡±ç ‡∞ú‡±ã‡∞°‡∞ø‡∞Ç‡∞ö‡∞æ‡∞≤‡∞ø.",
          adminStatusLabel:"‡∞Ö‡∞°‡±ç‡∞Æ‡∞ø‡∞®‡±ç ‡∞∏‡±ç‡∞ü‡±á‡∞ü‡∞∏‡±ç:",
          addVideoTitle:"‡∞µ‡±Ä‡∞°‡∞ø‡∞Ø‡±ã ‡∞Ø‡∞æ‡∞°‡±ç ‡∞ö‡±á‡∞Ø‡∞Ç‡∞°‡∞ø",
          brandLabel:"‡∞¨‡±ç‡∞∞‡∞æ‡∞Ç‡∞°‡±ç",
          modelLabel:"‡∞Æ‡±ã‡∞°‡∞≤‡±ç",
          videoTitleLabel:"‡∞µ‡±Ä‡∞°‡∞ø‡∞Ø‡±ã ‡∞ü‡±à‡∞ü‡∞ø‡∞≤‡±ç",
          youtubeLabel:"YouTube URL ‡∞≤‡±á‡∞¶‡∞æ ID",
          addVideoButton:"‡∞µ‡±Ä‡∞°‡∞ø‡∞Ø‡±ã ‡∞Ø‡∞æ‡∞°‡±ç ‡∞ö‡±á‡∞Ø‡∞Ç‡∞°‡∞ø",
          exportBackup:"‡∞¨‡±ç‡∞Ø‡∞æ‡∞ï‡∞™‡±ç ‡∞é‡∞ó‡±Å‡∞Æ‡∞§‡∞ø",
          importBackup:"‡∞¨‡±ç‡∞Ø‡∞æ‡∞ï‡∞™‡±ç ‡∞¶‡∞ø‡∞ó‡±Å‡∞Æ‡∞§‡∞ø",
          logout:"‡∞≤‡∞æ‡∞ó‡±å‡∞ü‡±ç",
          lastUpdatedPrefix:"‡∞ö‡∞ø‡∞µ‡∞∞‡∞ø‡∞∏‡∞æ‡∞∞‡∞ø ‡∞Ö‡∞™‡±ç‡∞°‡±á‡∞ü‡±ç:",
          viewByBike:"‡∞¨‡±à‡∞ï‡±ç ‡∞¶‡±ç‡∞µ‡∞æ‡∞∞‡∞æ",
          viewAll:"‡∞Ö‡∞®‡±ç‡∞®‡∞ø ‡∞µ‡±Ä‡∞°‡∞ø‡∞Ø‡±ã‡∞≤‡±Å"
        },
        ta:{
          title:"BikeFix Hub",
          search:"‡Æµ‡ØÄ‡Æü‡Æø‡ÆØ‡Øã‡Æï‡Øç‡Æï‡Æ≥‡Øà ‡Æ§‡Øá‡Æü‡ØÅ‡Æô‡Øç‡Æï‡Æ≥‡Øç..",
          chooseBrand:"1. ‡Æµ‡Ææ‡Æï‡Æ© ‡Æ™‡Æø‡Æ∞‡Ææ‡Æ£‡Øç‡Æü‡Øç ‡Æ§‡Øá‡Æ∞‡Øç‡Æµ‡ØÅ",
          chooseModel:"2. ‡ÆÆ‡Ææ‡Æü‡Æ≤‡Øç ‡Æ§‡Øá‡Æ∞‡Øç‡Æµ‡ØÅ",
          noVideos:"‡Æµ‡ØÄ‡Æü‡Æø‡ÆØ‡Øã‡Æï‡Øç‡Æï‡Æ≥‡Øç ‡Æá‡Æ≤‡Øç‡Æ≤‡Øà. ‡Æ®‡Æø‡Æ∞‡Øç‡Æµ‡Ææ‡Æï‡Æø ‡Æö‡Øá‡Æ∞‡Øç‡Æï‡Øç‡Æï ‡Æµ‡Øá‡Æ£‡Øç‡Æü‡ØÅ‡ÆÆ‡Øç.",
          adminStatusLabel:"‡Æ®‡Æø‡Æ∞‡Øç‡Æµ‡Ææ‡Æï ‡Æ®‡Æø‡Æ≤‡Øà:",
          addVideoTitle:"‡Æµ‡ØÄ‡Æü‡Æø‡ÆØ‡Øã ‡Æö‡Øá‡Æ∞‡Øç‡Æï‡Øç‡Æï‡Æµ‡ØÅ‡ÆÆ‡Øç",
          brandLabel:"‡Æ™‡Æø‡Æ∞‡Ææ‡Æ£‡Øç‡Æü‡Øç",
          modelLabel:"‡ÆÆ‡Ææ‡Æü‡Æ≤‡Øç",
          videoTitleLabel:"‡Æµ‡ØÄ‡Æü‡Æø‡ÆØ‡Øã ‡Æ§‡Æ≤‡Øà‡Æ™‡Øç‡Æ™‡ØÅ",
          youtubeLabel:"YouTube URL ‡ÆÖ‡Æ≤‡Øç‡Æ≤‡Æ§‡ØÅ ID",
          addVideoButton:"‡Æµ‡ØÄ‡Æü‡Æø‡ÆØ‡Øã ‡Æö‡Øá‡Æ∞‡Øç‡Æï‡Øç‡Æï‡Æµ‡ØÅ‡ÆÆ‡Øç",
          exportBackup:"‡Æï‡Ææ‡Æ™‡Øç‡Æ™‡ØÅ‡Æ™‡Øç ‡Æ™‡Æø‡Æ∞‡Æ§‡Æø ‡Æé‡Æï‡Øç‡Æ∏‡Øç‡Æ™‡Øã‡Æ∞‡Øç‡Æü‡Øç",
          importBackup:"‡Æï‡Ææ‡Æ™‡Øç‡Æ™‡ØÅ‡Æ™‡Øç ‡Æ™‡Æø‡Æ∞‡Æ§‡Æø ‡Æá‡ÆÆ‡Øç‡Æ™‡Øã‡Æ∞‡Øç‡Æü‡Øç",
          logout:"‡Æ≤‡Ææ‡Æï‡Øç ‡ÆÖ‡Æµ‡ØÅ‡Æü‡Øç",
          lastUpdatedPrefix:"‡Æï‡Æü‡Øà‡Æö‡Æø‡ÆØ‡Ææ‡Æï ‡Æ™‡ØÅ‡Æ§‡ØÅ‡Æ™‡Øç‡Æ™‡Æø‡Æï‡Øç‡Æï‡Æ™‡Øç‡Æ™‡Æü‡Øç‡Æü‡Æ§‡ØÅ:",
          viewByBike:"‡Æ™‡Øà‡Æï‡Øç ‡ÆÖ‡Æü‡Æø‡Æ™‡Øç‡Æ™‡Æü‡Øà‡ÆØ‡Æø‡Æ≤‡Øç",
          viewAll:"‡ÆÖ‡Æ©‡Øà‡Æ§‡Øç‡Æ§‡ØÅ ‡Æµ‡ØÄ‡Æü‡Æø‡ÆØ‡Øã‡Æï‡Øç‡Æï‡Æ≥‡Øç"
        }
      };

      let currentLang = localStorage.getItem("uiLang") || "en";

      function applyLanguage() {
        const t = translations[currentLang] || translations.en;
        document.getElementById("logo").textContent = t.title;
        search.placeholder = t.search;
        document.querySelector('[data-i18n="chooseBrand"]').textContent = t.chooseBrand;
        document.querySelector('[data-i18n="chooseModel"]').textContent = t.chooseModel;
        empty.textContent = t.noVideos;
        document.querySelector('[data-i18n="adminStatusLabel"]').textContent = t.adminStatusLabel;
        document.querySelector('[data-i18n="addVideoTitle"]').textContent = t.addVideoTitle;
        document.querySelector('[data-i18n="brandLabel"]').textContent = t.brandLabel;
        document.querySelector('[data-i18n="modelLabel"]').textContent = t.modelLabel;
        document.querySelector('[data-i18n="videoTitleLabel"]').textContent = t.videoTitleLabel;
        document.querySelector('[data-i18n="youtubeLabel"]').textContent = t.youtubeLabel;
        document.querySelector('[data-i18n="addVideoButton"]').textContent = t.addVideoButton;
        document.querySelector('[data-i18n="exportBackup"]').textContent = t.exportBackup;
        document.querySelector('[data-i18n="importBackup"]').childNodes[0].nodeValue = t.importBackup + " ";
        document.querySelector('[data-i18n="logout"]').textContent = t.logout;
        document.getElementById("tabByBike").textContent = t.viewByBike;
        document.getElementById("tabAllVideos").textContent = t.viewAll;
        updateLastUpdated(latestUpdated);
      }

      function updateLastUpdated(dateObj) {
        latestUpdated = dateObj;
        const t = translations[currentLang] || translations.en;
        if (!dateObj) { lastUpdatedEl.textContent = ""; return; }
        const d = dateObj;
        const pad = n => (n < 10 ? "0" + n : n);
        const str = `${pad(d.getDate())}-${pad(d.getMonth()+1)}-${d.getFullYear()} ${pad(d.getHours())}:${pad(d.getMinutes())}`;
        lastUpdatedEl.textContent = `${t.lastUpdatedPrefix} ${str}`;
      }

      // init language pills
      document.querySelectorAll(".lang-pill").forEach(pill=>{
        if(pill.dataset.lang === currentLang) pill.classList.add("active");
        pill.addEventListener("click", ()=>{
          document.querySelectorAll(".lang-pill").forEach(p=>p.classList.remove("active"));
          pill.classList.add("active");
          currentLang = pill.dataset.lang;
          localStorage.setItem("uiLang", currentLang);
          applyLanguage();
        });
      });

      /* ------------ HELPERS ------------ */
      function setAdminStatus() {
        adminStatus.textContent = adminUnlocked ? "Logged in" : "Not logged in";
        adminStatus.style.color = adminUnlocked ? "green" : "red";
      }

      function extractId(url){
        return url
          .trim()
          .replace(/^https?:\/\//,"")
          .replace("youtu.be/","")
          .replace("www.youtube.com/watch?v=","")
          .replace("youtube.com/watch?v=","")
          .replace("www.youtube.com/shorts/","")
          .replace("youtube.com/shorts/","")
          .split(/[?&]/)[0];
      }

      function buildThumbUrl(ytId){
        return `https://img.youtube.com/vi/${ytId}/hqdefault.jpg`;
      }

      function render(){
        videoGrid.innerHTML = "";
        const q = search.value.toLowerCase();

        videos.forEach(v=>{
          let visible = true;
          if (viewMode === "bike") {
            visible = (v.brand === activeBrand &&
                       v.model === activeModel &&
                       v.title.toLowerCase().includes(q));
          } else {
            visible = v.title.toLowerCase().includes(q);
          }
          if(!visible) return;

          const card=document.createElement("div");
          card.className="video-card";
          card.dataset.id = v.id;

          const adminBtns = adminUnlocked ? `
            <div class="admin-actions">
              <button class="edit-btn" data-id="${v.id}">Edit</button>
              <button class="delete-btn" data-id="${v.id}">Delete</button>
            </div>` : "";

          card.innerHTML=`
            <div class="thumb-wrapper" data-yt="${v.ytId}">
              <img src="${buildThumbUrl(v.ytId)}" alt="thumbnail">
              <div class="thumb-overlay">
                <div class="play-btn"></div>
              </div>
            </div>
            <div class="video-info">
              ${v.title}
              <div class="video-meta">
                <span>${v.brand.toUpperCase()} ‚Ä¢ ${v.model}</span>
                ${adminBtns}
              </div>
            </div>
          `;
          videoGrid.appendChild(card);
        });

        empty.style.display = videoGrid.children.length===0 ? "block" : "none";
      }

      /* ---------- VIEW TABS ---------- */
      document.querySelectorAll(".view-tab").forEach(tab=>{
        tab.addEventListener("click", ()=>{
          document.querySelectorAll(".view-tab").forEach(t=>t.classList.remove("active"));
          tab.classList.add("active");
          viewMode = tab.dataset.view;
          render();
        });
      });

      /* ---------- MODELS ---------- */
      function loadModels(){
        const modelArea=document.getElementById("modelButtons");
        modelArea.innerHTML="";
        const allModels = models[activeBrand] || [];

        const storedModel = localStorage.getItem("lastModel");
        let initialModel = allModels[0];
        if(storedModel && allModels.includes(storedModel)) initialModel = storedModel;

        allModels.forEach((m)=>{
          const b=document.createElement("button");
          const isActive = (m === initialModel);
          b.className="filter-btn" + (isActive ? " active" : "");
          b.innerText=m;
          b.onclick=()=>{
            document.querySelectorAll("#modelButtons .filter-btn").forEach(x=>x.classList.remove("active"));
            b.classList.add("active");
            activeModel=m;
            localStorage.setItem("lastModel", activeModel);
            render();
          };
          modelArea.appendChild(b);
          if(isActive) activeModel = m;
        });
      }

      // restore last brand/model
      const storedBrand = localStorage.getItem("lastBrand");
      if (storedBrand && models[storedBrand]) {
        activeBrand = storedBrand;
        // update active button after we set up brand buttons below
      }

      // Brand buttons
      const brandButtons = document.querySelectorAll("#brandButtons .filter-btn");
      brandButtons.forEach(btn=>{
        if(btn.dataset.brand === activeBrand) btn.classList.add("active");
        btn.addEventListener("click", ()=>{
          brandButtons.forEach(x=>x.classList.remove("active"));
          btn.classList.add("active");
          activeBrand=btn.dataset.brand;
          localStorage.setItem("lastBrand", activeBrand);
          loadModels();
          render();
        });
      });

      loadModels();

      // Search
      search.oninput=render;

      // Dark mode
      const darkToggle=document.getElementById("darkToggle");
      function applyTheme(){
        const mode=localStorage.getItem("theme");
        if(mode==="dark"){
          document.body.classList.add("dark");
          darkToggle.textContent="‚òÄÔ∏è";
        }else{
          document.body.classList.remove("dark");
          darkToggle.textContent="üåô";
        }
      }
      darkToggle.onclick=()=>{
        const dark=document.body.classList.toggle("dark");
        localStorage.setItem("theme",dark?"dark":"light");
        applyTheme();
      };
      applyTheme();

      // Refresh button
      document.getElementById("refreshBtn").onclick = ()=>location.reload();

      // Admin selectors
      const bSel=document.getElementById("adminBrand");
      const mSel=document.getElementById("adminModel");
      Object.keys(models).forEach(k=>{
        const o=document.createElement("option");
        o.value=k;
        o.text=k.toUpperCase();
        bSel.appendChild(o);
      });
      bSel.onchange=()=>{
        mSel.innerHTML="";
        (models[bSel.value] || []).forEach(m=>{
          const o=document.createElement("option");
          o.value=m;
          o.text=m;
          mSel.appendChild(o);
        });
      };
      bSel.onchange();

      /* ---------- HIDDEN ADMIN LOGIN (click logo 5 times) ---------- */
      let logoClicks = 0;
      let logoTimer = null;

      function unlockAdmin() {
        adminUnlocked = true;
        setAdminStatus();
        adminPanel.style.display = "block";
        alert("Admin login success");
        render(); // show edit/delete buttons
      }

      function triggerAdminLogin(){
        auth.signInWithPopup(provider)
          .then(res=>{
            const email = res.user && res.user.email;
            if(email === ADMIN_EMAIL){
              unlockAdmin();
            }else{
              alert("This Google account is not allowed.");
              auth.signOut();
            }
          })
          .catch(err=>{
            console.error("Google login failed:", err);
            alert("Google login failed: " + err.code);
          });
      }

      logo.onclick = () => {
        logoClicks++;
        if(logoClicks === 1){
          logoTimer = setTimeout(()=>{ logoClicks = 0; }, 2000);
        }
        if(logoClicks >= 5){
          logoClicks = 0;
          clearTimeout(logoTimer);
          triggerAdminLogin();
        }
      };

      // Logout
      document.getElementById("logoutBtn").onclick = () => {
        if (!adminUnlocked) return;
        if (!confirm("Log out admin?")) return;
        auth.signOut().finally(()=>{
          adminUnlocked = false;
          setAdminStatus();
          adminPanel.style.display = "none";
          render();
        });
      };

      /* ---------- ADD VIDEO (requires admin) ---------- */
      document.getElementById("addVideoBtn").onclick=()=>{
        if(!adminUnlocked){
          alert("Login as admin first (tap logo 5 times).");
          return;
        }
        const brand=bSel.value;
        const model=mSel.value;
        const title=document.getElementById("adminTitle").value.trim();
        const url=document.getElementById("adminUrl").value.trim();
        if(!title || !url){
          alert("Fill all fields");
          return;
        }
        const ytId=extractId(url);

        db.collection("videos").add({
          brand, model, title, ytId,
          createdAt: firebase.firestore.FieldValue.serverTimestamp()
        })
        .then(()=>{
          document.getElementById("adminTitle").value="";
          document.getElementById("adminUrl").value="";
          alert("Video added!");
        })
        .catch(err=>{
          console.error(err);
          alert("Error saving video: " + err.code);
        });
      };

      /* ---------- EDIT / DELETE (admin only) ---------- */
      document.addEventListener("click", (e)=>{
        // play click (thumbnail)
        const thumb = e.target.closest(".thumb-wrapper");
        if(thumb){
          const ytId = thumb.dataset.yt;
          // replace thumb with iframe
          const parent = thumb.parentElement;
          const iframeWrapper = document.createElement("div");
          iframeWrapper.innerHTML = `<iframe src="https://www.youtube.com/embed/${ytId}" allowfullscreen></iframe>`;
          parent.replaceChild(iframeWrapper.firstChild, thumb);
          return;
        }

        if(!adminUnlocked) return;

        if(e.target.classList.contains("edit-btn")){
          const id=e.target.dataset.id;
          const vid = videos.find(v=>v.id===id);
          if(!vid) return;
          const updated = prompt("Edit title:", vid.title);
          if(!updated) return;
          db.collection("videos").doc(id).update({ title:updated.trim() })
            .catch(err=>{
              console.error(err);
              alert("Update failed: " + err.code);
            });
        }

        if(e.target.classList.contains("delete-btn")){
          const id=e.target.dataset.id;
          const vid = videos.find(v=>v.id===id);
          if(!vid) return;
          if(!confirm(`Delete video "${vid.title}"? This cannot be undone.`)) return;
          db.collection("videos").doc(id).delete()
            .catch(err=>{
              console.error(err);
              alert("Delete failed: " + err.code);
            });
        }
      });

      /* ---------- BACKUP EXPORT / IMPORT ---------- */
      const exportBtn = document.getElementById("exportBtn");
      const importInput = document.getElementById("importInput");

      exportBtn.onclick = () => {
        if(!adminUnlocked){
          alert("Login as admin first.");
          return;
        }
        if(!videos.length){
          alert("No videos to export.");
          return;
        }
        const data = videos.map(v=>({
          brand:v.brand, model:v.model, title:v.title,
          ytId:v.ytId, createdAtMs:v.createdAtMs || null
        }));
        const blob = new Blob([JSON.stringify(data,null,2)],{type:"application/json"});
        const url = URL.createObjectURL(blob);
        const a = document.createElement("a");
        a.href = url;
        a.download = "bikefix-backup.json";
        document.body.appendChild(a);
        a.click();
        document.body.removeChild(a);
        URL.revokeObjectURL(url);
      };

      importInput.onchange = (e) => {
        if(!adminUnlocked){
          alert("Login as admin first.");
          return;
        }
        const file = e.target.files[0];
        if(!file) return;
        if(!confirm("Importing backup will REPLACE all existing videos. Continue?")){ 
          importInput.value=""; 
          return; 
        }
        const reader = new FileReader();
        reader.onload = () => {
          try{
            const data = JSON.parse(reader.result);
            if(!Array.isArray(data)) throw new Error("Invalid format");
            // delete all then insert
            db.collection("videos").get().then(snap=>{
              const batchDel = db.batch();
              snap.forEach(doc=>batchDel.delete(doc.ref));
              return batchDel.commit();
            }).then(()=>{
              const batchAdd = db.batch();
              data.forEach(v=>{
                const ref = db.collection("videos").doc();
                batchAdd.set(ref,{
                  brand:v.brand,
                  model:v.model,
                  title:v.title,
                  ytId:v.ytId,
                  createdAt: v.createdAtMs ? new Date(v.createdAtMs) : firebase.firestore.FieldValue.serverTimestamp()
                });
              });
              return batchAdd.commit();
            }).then(()=>{
              alert("Backup imported successfully.");
            }).catch(err=>{
              console.error(err);
              alert("Import failed: " + err.code);
            });
          }catch(err){
            alert("Invalid backup file.");
          }finally{
            importInput.value="";
          }
        };
        reader.readAsText(file);
      };

      /* ---------- FIRESTORE LISTENER ---------- */
      db.collection("videos").orderBy("createdAt","asc")
        .onSnapshot(snap=>{
          videos=[];
          let latest = null;
          snap.forEach(doc=>{
            const d=doc.data();
            let createdAtMs = null;
            if(d.createdAt && d.createdAt.toDate){
              const dt = d.createdAt.toDate();
              createdAtMs = dt.getTime();
              if(!latest || dt > latest) latest = dt;
            }
            videos.push({
              id:doc.id,
              brand:d.brand,
              model:d.model,
              title:d.title,
              ytId:d.ytId,
              createdAtMs
            });
          });
          updateLastUpdated(latest);
          render();
        });

      /* ---------- PWA MANIFEST + SERVICE WORKER ---------- */
      // dynamic manifest so we only need this one file
      const manifest = {
        name: "BikeFix Hub",
        short_name: "BikeFix",
        start_url: ".",
        display: "standalone",
        background_color: "#000000",
        theme_color: "#111827",
        icons: []
      };
      const manifestBlob = new Blob([JSON.stringify(manifest)], {type:"application/json"});
      const manifestURL = URL.createObjectURL(manifestBlob);
      const mlink = document.createElement("link");
      mlink.rel = "manifest";
      mlink.href = manifestURL;
      document.head.appendChild(mlink);

      if ("serviceWorker" in navigator) {
        const swCode = `
          self.addEventListener('install', e => self.skipWaiting());
          self.addEventListener('activate', e => self.clients.claim());
          self.addEventListener('fetch', e => {
            if (e.request.method !== 'GET') return;
            e.respondWith(
              caches.open('bikefix-cache-v1').then(cache => 
                fetch(e.request).then(resp => {
                  cache.put(e.request, resp.clone());
                  return resp;
                }).catch(() => cache.match(e.request))
              )
            );
          });
        `;
        const swBlob = new Blob([swCode], {type:"text/javascript"});
        const swUrl = URL.createObjectURL(swBlob);
        navigator.serviceWorker.register(swUrl).catch(err => console.log("SW error", err));
      }

      // init text / status
      setAdminStatus();
      applyLanguage();
    });
  </script>
</body>
</html>
