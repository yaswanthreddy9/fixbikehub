<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>BikeFix Hub</title>

  <style>
    /* ---- BASE STYLES ---- */
    *{margin:0;padding:0;box-sizing:border-box;font-family:Arial,Helvetica,sans-serif}
    body{background:#f4f4f4;color:#222}
    header{background:#111827;color:#fff;padding:12px;position:sticky;top:0;z-index:10}
    .nav{display:flex;align-items:center;justify-content:space-between;gap:10px;max-width:1100px;margin:auto;flex-wrap:wrap}
    .logo{font-size:20px;font-weight:700;cursor:pointer}
    .toolbar{display:flex;align-items:center;gap:8px;flex-wrap:nowrap}
    .search-box input{padding:8px 10px;border-radius:50px;border:1px solid #555;background:#000;color:#fff;width:220px;font-size:14px}
    .admin-btn{background:#111;border:1px solid #666;color:white;padding:6px 10px;border-radius:50px;cursor:pointer;font-size:16px;min-width:40px;text-align:center}
    main{max-width:1100px;margin:auto;padding:16px}
    .filters-title{font-size:14px;margin:10px 0;color:#444;font-weight:600}
    .buttons{display:flex;flex-wrap:wrap;gap:8px}
    .filter-btn{padding:8px 15px;border-radius:50px;border:1px solid #aaa;background:white;cursor:pointer;font-size:14px}
    .filter-btn.active{background:#2563eb;color:white;border-color:#0d56db}
    .video-grid{display:grid;gap:15px;margin-top:20px}
    .video-card{background:white;border-radius:10px;box-shadow:0 4px 10px rgba(0,0,0,.1);overflow:hidden}
    iframe{width:100%;height:220px;border:none}
    .video-info{padding:10px;font-size:14px;font-weight:600}
    .video-meta{margin-top:6px;font-size:12px;display:flex;justify-content:space-between;align-items:center;gap:6px}
    .admin-actions button{border:none;padding:4px 6px;border-radius:5px;font-size:11px;cursor:pointer}
    .edit-btn{background:#f59e0b;color:white}
    .delete-btn{background:#ef4444;color:white}
    #empty{background:#ddd;text-align:center;padding:20px;border-radius:10px;margin-top:20px;color:#444}

    /* ---- ADMIN PANEL ---- */
    #adminPanel{display:none;background:#e5e7eb;padding:15px;border-radius:10px;margin-top:20px}
    #adminPanel label{font-size:13px;font-weight:600;margin-top:8px;display:block}
    #adminPanel input,#adminPanel select{padding:6px;border-radius:6px;border:1px solid #ccc;width:100%;margin-top:4px;font-size:14px}
    #adminPanel button{padding:8px 10px;background:#22c55e;color:white;border:none;border-radius:6px;font-weight:bold;cursor:pointer;margin-top:10px;font-size:13px}
    #adminNote{font-size:12px;margin-bottom:6px;color:#555}

    /* ---- DARK MODE ---- */
    body.dark{background:#0f0f0f;color:white}
    body.dark header{background:#000}
    body.dark .filter-btn{background:#1a1a1a;border-color:#333;color:white}
    body.dark .filter-btn.active{background:#2563eb;color:white}
    body.dark input,body.dark select{background:#111;color:white;border-color:#444}
    body.dark .video-card{background:#1a1a1a}
    body.dark #empty{background:#333;color:#bbb}

    /* --- MOBILE LAYOUT --- */
    @media(max-width:600px){
      .nav{flex-direction:column;align-items:stretch}
      .toolbar{width:100%;justify-content:center}
      .search-box{flex:1}
      .search-box input{width:100%}
      iframe{height:240px}
    }
  </style>
</head>

<body>
  <header>
    <div class="nav">
      <div class="logo" id="logo">BikeFix Hub</div>
      <div class="toolbar">
        <div class="search-box">
          <input id="searchInput" placeholder="Search videos.." />
        </div>
        <button id="darkToggle" class="admin-btn">ðŸŒ™</button>
        <!-- No visible admin button anymore -->
      </div>
    </div>
  </header>

  <main>
    <div class="filters-title">1. Choose Brand</div>
    <div id="brandButtons" class="buttons">
      <button class="filter-btn active" data-brand="hero">Hero MotoCorp</button>
      <button class="filter-btn" data-brand="bajaj">Bajaj Auto</button>
      <button class="filter-btn" data-brand="tvs">TVS Motor</button>
      <button class="filter-btn" data-brand="royal">Royal Enfield</button>
    </div>

    <div class="filters-title">2. Choose Model</div>
    <div id="modelButtons" class="buttons"></div>

    <div id="empty">No videos yet. Add videos using admin mode.</div>
    <div id="videos" class="video-grid"></div>

    <div id="adminPanel">
      <div id="adminNote">
        Admin status: <b id="adminStatus">Not logged in</b><br>
        (Secret: tap "BikeFix Hub" 5 times quickly to open Google login)
      </div>

      <h3>Add Video</h3>

      <label>Brand</label>
      <select id="adminBrand"></select>

      <label>Model</label>
      <select id="adminModel"></select>

      <label>Video Title</label>
      <input id="adminTitle" placeholder="Ex: Pulsar 150 Clutch Repair" />

      <label>YouTube URL or ID</label>
      <input id="adminUrl" placeholder="https://youtube.com/watch?v=xxxx" />

      <button id="addVideoBtn">ADD VIDEO</button>
    </div>
  </main>

  <!-- Firebase CDN -->
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>

  <script>
    document.addEventListener("DOMContentLoaded", function () {

      /* ------------ FIREBASE CONFIG ------------ */
      const firebaseConfig = {
        apiKey: "AIzaSyBU93PMVY7YKUaez3tkpiywYtIcpZTUQBw",
        authDomain: "bike-fix-pulsar.firebaseapp.com",
        projectId: "bike-fix-pulsar",
        storageBucket: "bike-fix-pulsar.firebasestorage.app",
        messagingSenderId: "464082773378",
        appId: "1:464082773378:web:6376c2ddd5635fd2061b9b"
      };

      firebase.initializeApp(firebaseConfig);
      const db = firebase.firestore();
      const auth = firebase.auth();
      const provider = new firebase.auth.GoogleAuthProvider();

      const ADMIN_EMAIL = "myeswanthreddy321@gmail.com";

      /* ------------ MODEL DATA ------------ */
      const models = {
        hero:["Splendor Plus","HF Deluxe","Glamour","Passion Plus","Xtreme 160R","Xpulse 200 4V","Karizma XMR","Mavrick 440"],
        bajaj:["All Pulsar (General)","Pulsar 150","Pulsar NS200","Pulsar 220F","Dominar 400","Avenger Cruise 220","Platina","Chetak Electric"],
        tvs:["Apache RTR 160","Apache RTR 310","Raider 125","Ronin","Sport","Jupiter","iQube Electric"],
        royal:["Classic 350","Bullet 350","Himalayan 450","Interceptor 650","Meteor 350","Hunter 350","Shotgun 650"]
      };

      let activeBrand="hero", activeModel=null, adminUnlocked=false;
      let videos=[];

      const search = document.getElementById("searchInput");
      const videoGrid = document.getElementById("videos");
      const empty = document.getElementById("empty");
      const adminStatus = document.getElementById("adminStatus");
      const adminPanel = document.getElementById("adminPanel");
      const logo = document.getElementById("logo");

      function setAdminStatus() {
        adminStatus.textContent = adminUnlocked ? "Logged in" : "Not logged in";
        adminStatus.style.color = adminUnlocked ? "green" : "red";
      }

      function extractId(url){
        return url
          .trim()
          .replace(/^https?:\/\//,"")
          .replace("youtu.be/","")
          .replace("www.youtube.com/watch?v=","")
          .replace("youtube.com/watch?v=","")
          .replace("www.youtube.com/shorts/","")
          .replace("youtube.com/shorts/","")
          .split(/[?&]/)[0];
      }

      function render(){
        videoGrid.innerHTML="";
        const q = search.value.toLowerCase();

        videos.forEach(v=>{
          const visible =
            v.brand===activeBrand &&
            v.model===activeModel &&
            v.title.toLowerCase().includes(q);

          if(!visible) return;

          const card=document.createElement("div");
          card.className="video-card";
          card.dataset.id = v.id;

          const adminBtns = adminUnlocked ? `
            <div class="admin-actions">
              <button class="edit-btn" data-id="${v.id}">Edit</button>
              <button class="delete-btn" data-id="${v.id}">Delete</button>
            </div>` : "";

          card.innerHTML=`
            <iframe src="https://www.youtube.com/embed/${v.ytId}" allowfullscreen></iframe>
            <div class="video-info">
              ${v.title}
              <div class="video-meta">
                <span>${v.brand.toUpperCase()} â€¢ ${v.model}</span>
                ${adminBtns}
              </div>
            </div>
          `;
          videoGrid.appendChild(card);
        });

        empty.style.display = videoGrid.children.length===0 ? "block" : "none";
      }

      /* ---------- MODELS ---------- */
      function loadModels(){
        const modelArea=document.getElementById("modelButtons");
        modelArea.innerHTML="";
        (models[activeBrand] || []).forEach((m,i)=>{
          const b=document.createElement("button");
          b.className="filter-btn"+(i===0?" active":"");
          b.innerText=m;
          b.onclick=()=>{
            document.querySelectorAll("#modelButtons .filter-btn").forEach(x=>x.classList.remove("active"));
            b.classList.add("active");
            activeModel=m;
            render();
          };
          modelArea.appendChild(b);
          if(i===0) activeModel=m;
        });
      }
      loadModels();

      // Brand buttons
      document.querySelectorAll("#brandButtons .filter-btn").forEach(btn=>{
        btn.onclick=()=>{
          document.querySelectorAll("#brandButtons .filter-btn").forEach(x=>x.classList.remove("active"));
          btn.classList.add("active");
          activeBrand=btn.dataset.brand;
          loadModels();
          render();
        };
      });

      // Search
      search.oninput=render;

      // Dark mode
      const darkToggle=document.getElementById("darkToggle");
      function applyTheme(){
        const mode=localStorage.getItem("theme");
        if(mode==="dark"){
          document.body.classList.add("dark");
          darkToggle.textContent="â˜€ï¸";
        }else{
          document.body.classList.remove("dark");
          darkToggle.textContent="ðŸŒ™";
        }
      }
      darkToggle.onclick=()=>{
        const dark=document.body.classList.toggle("dark");
        localStorage.setItem("theme",dark?"dark":"light");
        applyTheme();
      };
      applyTheme();

      // Admin selectors
      const bSel=document.getElementById("adminBrand");
      const mSel=document.getElementById("adminModel");
      Object.keys(models).forEach(k=>{
        const o=document.createElement("option");
        o.value=k;
        o.text=k.toUpperCase();
        bSel.appendChild(o);
      });
      bSel.onchange=()=>{
        mSel.innerHTML="";
        (models[bSel.value] || []).forEach(m=>{
          const o=document.createElement("option");
          o.value=m;
          o.text=m;
          mSel.appendChild(o);
        });
      };
      bSel.onchange();

      // ---------- HIDDEN ADMIN LOGIN (click logo 5 times) ----------
      let logoClicks = 0;
      let logoTimer = null;

      function triggerAdminLogin(){
        auth.signInWithPopup(provider)
          .then(res=>{
            const email = res.user && res.user.email;
            if(email === ADMIN_EMAIL){
              adminUnlocked = true;
              setAdminStatus();
              adminPanel.style.display = "block";
              alert("Admin login success");
              render(); // show edit/delete buttons
            }else{
              alert("This Google account is not allowed.");
              auth.signOut();
            }
          })
          .catch(err=>{
            console.error("Google login failed:", err);
            alert("Google login failed: " + err.code);
          });
      }

      logo.onclick = () => {
        logoClicks++;
        if(logoClicks === 1){
          // start timer
          logoTimer = setTimeout(()=>{ logoClicks = 0; }, 2000);
        }
        if(logoClicks >= 5){
          logoClicks = 0;
          clearTimeout(logoTimer);
          triggerAdminLogin();
        }
      };

      // ---------- ADD VIDEO (requires admin) ----------
      document.getElementById("addVideoBtn").onclick=()=>{
        if(!adminUnlocked){
          alert("Login as admin first (tap logo 5 times).");
          return;
        }
        const brand=bSel.value;
        const model=mSel.value;
        const title=document.getElementById("adminTitle").value.trim();
        const url=document.getElementById("adminUrl").value.trim();
        if(!title || !url){
          alert("Fill all fields");
          return;
        }
        const ytId=extractId(url);

        db.collection("videos").add({
          brand, model, title, ytId,
          createdAt: firebase.firestore.FieldValue.serverTimestamp()
        })
        .then(()=>{
          document.getElementById("adminTitle").value="";
          document.getElementById("adminUrl").value="";
          alert("Video added!");
        })
        .catch(err=>{
          console.error(err);
          alert("Error saving video: " + err.code);
        });
      };

      // ---------- EDIT / DELETE (admin only) ----------
      document.addEventListener("click", (e)=>{
        if(!adminUnlocked) return;

        if(e.target.classList.contains("edit-btn")){
          const id=e.target.dataset.id;
          const vid = videos.find(v=>v.id===id);
          if(!vid) return;
          const updated = prompt("Edit title:", vid.title);
          if(!updated) return;
          db.collection("videos").doc(id).update({ title:updated.trim() })
            .catch(err=>{
              console.error(err);
              alert("Update failed: " + err.code);
            });
        }

        if(e.target.classList.contains("delete-btn")){
          const id=e.target.dataset.id;
          if(!confirm("Delete this video?")) return;
          db.collection("videos").doc(id).delete()
            .catch(err=>{
              console.error(err);
              alert("Delete failed: " + err.code);
            });
        }
      });

      // ---------- FIRESTORE LISTENER ----------
      db.collection("videos").orderBy("createdAt","asc")
        .onSnapshot(snap=>{
          videos=[];
          snap.forEach(doc=>{
            const d=doc.data();
            videos.push({ id:doc.id, brand:d.brand, model:d.model, title:d.title, ytId:d.ytId });
          });
          render();
        });

      setAdminStatus();
    });
  </script>
</body>
</html>
