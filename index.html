<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>BikeFix Hub</title>

<style>
*{margin:0;padding:0;box-sizing:border-box;font-family:Arial,Helvetica,sans-serif}
body{background:#f4f4f4;color:#222}

/* remove focus glow */
button:focus,input:focus,select:focus,textarea:focus{outline:none;box-shadow:none}

/* header */
header{background:#111827;color:#fff;padding:12px;position:sticky;top:0;z-index:10}
.nav{display:flex;justify-content:space-between;align-items:center;gap:10px;max-width:1100px;margin:auto;flex-wrap:wrap}
.logo{font-size:20px;font-weight:700;cursor:pointer}
.toolbar{display:flex;align-items:center;gap:8px}

/* buttons */
.header-btn{background:#111;border:1px solid #666;color:white;padding:6px 10px;border-radius:50px;cursor:pointer;font-size:18px}
.search-box input{padding:8px 12px;border-radius:50px;border:1px solid #555;background:#000;color:#fff;width:220px}

/* layout */
main{max-width:1100px;margin:auto;padding:16px}
.filters-title{font-size:14px;margin:10px 0;color:#444;font-weight:600}
.buttons{display:flex;flex-wrap:wrap;gap:8px}
.filter-btn{padding:8px 15px;border-radius:50px;border:1px solid #aaa;background:#fff;cursor:pointer;font-size:14px}
.filter-btn.active{background:#2563eb;color:#fff;border-color:#2563eb}

/* videos */
.video-grid{display:grid;gap:15px;margin-top:20px}
.video-card{background:#fff;border-radius:10px;box-shadow:0 4px 10px rgba(0,0,0,.1);overflow:hidden}
iframe{width:100%;height:220px;border:none}
.video-info{padding:10px;font-weight:600;font-size:14px}
.video-meta{display:flex;justify-content:space-between;font-size:12px;margin-top:6px;color:#555}

/* empty */
#empty{background:#ddd;text-align:center;padding:20px;border-radius:10px;margin-top:20px;color:#444}

/* admin */
.admin-actions button{border:none;padding:4px 6px;border-radius:5px;font-size:11px;color:white;cursor:pointer}
.edit-btn{background:#f59e0b}
.delete-btn{background:#ef4444}

/* dark mode */
body.dark{background:#0f0f0f;color:#fff}
body.dark header{background:#000}
body.dark .filter-btn{background:#1a1a1a;color:#fff;border-color:#333}
body.dark .filter-btn.active{background:#2563eb}
body.dark .video-card{background:#1a1a1a}
body.dark #empty{background:#333;color:#bbb}

/* mobile */
@media(max-width:600px){
  .search-box input{width:100%}
}
</style>
</head>

<body>
<header>
  <div class="nav">
    <div class="logo" id="logo">BikeFix Hub</div>
    <div class="toolbar">
      <div class="search-box">
        <input id="searchInput" placeholder="Search videos.." />
      </div>
      <button id="darkToggle" class="header-btn">ðŸŒ™</button>
      <button id="userBtn" class="header-btn">ðŸ‘¤</button>
    </div>
  </div>
</header>

<main>
  <div class="filters-title">1. Choose Brand</div>
  <div id="brandButtons" class="buttons">
    <button class="filter-btn" data-brand="hero">Hero MotoCorp</button>
    <button class="filter-btn" data-brand="bajaj">Bajaj Auto</button>
    <button class="filter-btn" data-brand="tvs">TVS Motor</button>
    <button class="filter-btn" data-brand="royal">Royal Enfield</button>
  </div>

  <div class="filters-title">2. Choose Model</div>
  <div id="modelButtons" class="buttons"></div>

  <div id="empty">No videos yet.</div>
  <div id="videos" class="video-grid"></div>
</main>

<!-- Firebase -->
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>

<script>
document.addEventListener("DOMContentLoaded",()=>{

/* ---------- FIREBASE ---------- */
firebase.initializeApp({
  apiKey:"AIzaSyBU93PMVY7YKUaez3tkpiywYtIcpZTUQBw",
  authDomain:"bike-fix-pulsar.firebaseapp.com",
  projectId:"bike-fix-pulsar"
});
const db=firebase.firestore();
const auth=firebase.auth();
const provider=new firebase.auth.GoogleAuthProvider();
const ADMIN_EMAIL="myeswanthreddy321@gmail.com";

/* ---------- DATA ---------- */
const models={
  hero:["Splendor Plus","HF Deluxe","Glamour","Passion Plus","Xtreme 160R","Xpulse 200 4V","Karizma XMR","Mavrick 440"],
  bajaj:["Pulsar 150","Pulsar NS200","Pulsar 220F","Dominar 400"],
  tvs:["Apache RTR 160","Raider 125","Ronin"],
  royal:["Classic 350","Himalayan 450","Hunter 350"]
};

let activeBrand="hero";
let activeModel=null;
let adminUnlocked=false;
let videos=[];

/* ---------- HELPERS ---------- */
function extractId(url){
  return url.replace(/^https?:\/\//,"")
            .replace("youtu.be/","")
            .replace("youtube.com/watch?v=","")
            .split(/[?&]/)[0];
}

function applyBrandUI(){
  document.querySelectorAll("#brandButtons .filter-btn")
    .forEach(b=>b.classList.toggle("active",b.dataset.brand===activeBrand));
}

/* ---------- MODELS ---------- */
function loadModels(pref){
  const box=document.getElementById("modelButtons");
  box.innerHTML="";
  const list=models[activeBrand];
  activeModel=pref&&list.includes(pref)?pref:list[0];

  list.forEach(m=>{
    const b=document.createElement("button");
    b.className="filter-btn"+(m===activeModel?" active":"");
    b.textContent=m;
    b.onclick=()=>{
      document.querySelectorAll("#modelButtons .filter-btn").forEach(x=>x.classList.remove("active"));
      b.classList.add("active");
      activeModel=m;
      savePrefs();
      render();
    };
    box.appendChild(b);
  });
}

/* ---------- RENDER ---------- */
function render(){
  const q=document.getElementById("searchInput").value.toLowerCase();
  const grid=document.getElementById("videos");
  grid.innerHTML="";
  let count=0;

  videos.forEach(v=>{
    if(v.brand!==activeBrand||v.model!==activeModel||!v.title.toLowerCase().includes(q)) return;
    count++;
    const card=document.createElement("div");
    card.className="video-card";
    card.innerHTML=`
      <iframe src="https://www.youtube.com/embed/${v.ytId}" allowfullscreen></iframe>
      <div class="video-info">${v.title}
        <div class="video-meta">
          <span>${v.brand} â€¢ ${v.model}</span>
          ${adminUnlocked?`<span>
            <button class="edit-btn" data-id="${v.id}">Edit</button>
            <button class="delete-btn" data-id="${v.id}">Delete</button>
          </span>`:""}
        </div>
      </div>`;
    grid.appendChild(card);
  });
  document.getElementById("empty").style.display=count? "none":"block";
}

/* ---------- PREFS ---------- */
function savePrefs(){
  localStorage.setItem("lastBrand",activeBrand);
  localStorage.setItem("lastModel",activeModel);
}

/* ---------- INIT ---------- */
const lb=localStorage.getItem("lastBrand");
if(lb&&models[lb]) activeBrand=lb;
applyBrandUI();
loadModels(localStorage.getItem("lastModel"));

/* ---------- BRAND CLICK ---------- */
document.querySelectorAll("#brandButtons .filter-btn").forEach(btn=>{
  btn.onclick=()=>{
    activeBrand=btn.dataset.brand;
    localStorage.removeItem("lastModel");
    applyBrandUI();
    loadModels(null);
    render();
  };
});

/* ---------- SEARCH ---------- */
document.getElementById("searchInput").oninput=render;

/* ---------- DARK MODE ---------- */
document.getElementById("darkToggle").onclick=()=>{
  document.body.classList.toggle("dark");
};

/* ---------- SECRET ADMIN ---------- */
let clicks=0,timer=null;
document.getElementById("logo").onclick=()=>{
  clicks++;
  if(clicks===1) timer=setTimeout(()=>clicks=0,2000);
  if(clicks>=5){
    clearTimeout(timer);clicks=0;
    auth.signInWithPopup(provider).then(r=>{
      if(r.user.email===ADMIN_EMAIL){
        adminUnlocked=true;
        alert("Admin unlocked");
        render();
      }else auth.signOut();
    });
  }
};

/* ---------- FIRESTORE ---------- */
db.collection("videos").onSnapshot(s=>{
  videos=[];
  s.forEach(d=>videos.push({id:d.id,...d.data()}));
  render();
});

/* ---------- ADMIN ACTIONS ---------- */
document.addEventListener("click",e=>{
  if(!adminUnlocked) return;
  if(e.target.classList.contains("delete-btn")){
    db.collection("videos").doc(e.target.dataset.id).delete();
  }
  if(e.target.classList.contains("edit-btn")){
    const v=videos.find(x=>x.id===e.target.dataset.id);
    const t=prompt("Edit title",v.title);
    if(t) db.collection("videos").doc(v.id).update({title:t});
  }
});

});
</script>
</body>
</html>
